#!/bin/bash

sudo tc qdisc add dev lo root netem delay 100ms

LATENCY=100 SIZE=1024 CONCURRENCY=1 make perf
LATENCY=100 SIZE=1024 CONCURRENCY=2 make perf
LATENCY=100 SIZE=1024 CONCURRENCY=4 make perf
LATENCY=100 SIZE=1024 CONCURRENCY=8 make perf

LATENCY=100 SIZE=2048 CONCURRENCY=1 make perf
LATENCY=100 SIZE=2048 CONCURRENCY=2 make perf
LATENCY=100 SIZE=2048 CONCURRENCY=4 make perf
LATENCY=100 SIZE=2048 CONCURRENCY=8 make perf

sudo tc qdisc del dev lo root netem